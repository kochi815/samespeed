<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚µãƒ¡ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
  <style>
    /* ä¿®æ­£ç‚¹1: bodyã‚¹ã‚¿ã‚¤ãƒ«ã‚’çµ±åˆã—ã€#bodyã‚»ãƒ¬ã‚¯ã‚¿ã‚’å‰Šé™¤ */
    body {
      font-family: 'M PLUS Rounded 1c', sans-serif;
      text-align: center;
      background-color: #e0f7fa; /* æ°´è‰²ç³»èƒŒæ™¯ */
      margin: 0;
      padding: 15px;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      min-height: 100vh;
      overflow-y: auto; /* åˆæœŸã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯ */
      padding-bottom: 30px;
      height: 100%;
      color: #444;
    }
    html {
      height: 100%;
    }

    h1 {
      font-size: 2em;
      color: #00796b; /* å°‘ã—æ¿ƒã„é’ç·‘ */
      font-weight: 700;
      margin-top: 20px;
      margin-bottom: 15px;
    }

    #question {
      font-size: 4.5em;
      margin: 30px 0 30px 0;
      color: #004d40; /* æ¿ƒã„ç·‘ */
      font-weight: 700;
      line-height: 1.2;
      min-height: 1.5em;
      opacity: 1;
      transform: scale(1);
    }

    #questionNumber, #timer {
        font-size: 1.1em;
        color: #004d40;
        margin: 3px 0;
    }
    #coinInfo {
        font-size: 1.1em;
        color: #004d40;
        margin-bottom: 10px;
    }
    #titleBadge {
        font-size: 1.3em;
        color: #00acc1; /* ãƒœã‚¿ãƒ³ã¨åŒç³»è‰² */
        margin: 15px 0;
        font-weight: 700;
        min-height: 1.3em;
    }
    #info {
      font-size: 1.2em;
      color: #006064; /* ã‚„ã‚„æ¿ƒã„ã‚·ã‚¢ãƒ³ */
      margin-bottom: 20px;
      min-height: 1.5em;
    }

    #startBtn, #homeBtn, #rankBtn {
      font-family: 'M PLUS Rounded 1c', sans-serif;
      font-size: 1.3em;
      padding: 15px 35px;
      margin: 10px;
      border: none;
      border-radius: 30px;
      background-color: #00acc1; /* ã‚·ã‚¢ãƒ³ */
      color: white;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
      font-weight: 700;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    #startBtn:hover, #homeBtn:hover, #rankBtn:hover {
      background-color: #00838f; /* å°‘ã—æ¿ƒã„ã‚·ã‚¢ãƒ³ */
    }
    #startBtn:active, #homeBtn:active, #rankBtn:active {
        transform: scale(0.97);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #rankList {
      display: none;
      margin-top: 25px;
      background: #ffffff;
      padding: 20px;
      border-radius: 15px;
      text-align: left;
      font-size: 1em;
      max-width: 500px;
      width: 90%;
      margin-left: auto;
      margin-right: auto;
      color: #004d40;
      border: 1px solid #b2ebf2; /* è–„ã„ã‚·ã‚¢ãƒ³ */
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    #rankList h2 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 15px;
      color: #00796b;
      font-size: 1.4em;
      font-weight: 700;
    }
    #rankList ul {
      list-style: none;
      padding: 0;
    }
    #rankList li {
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px dashed #e0f7fa; /* èƒŒæ™¯ã¨åŒç³»è‰²ã®è–„ã„è‰² */
      line-height: 1.5;
    }
    #rankList li:last-child {
      border-bottom: none;
    }

    .highlight {
      color: #00796b;
      font-weight: bold;
    }

    @keyframes fadeInScaleUp {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    .animate-reveal {
      animation: fadeInScaleUp 0.3s ease-out;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã¯çœç•¥ï¼ˆå¿…è¦ã§ã‚ã‚Œã°å‰ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚³ãƒ”ãƒ¼ï¼‰ */
    @media (max-width: 600px) {
        body { padding: 10px; padding-bottom: 20px; }
        h1 { font-size: 1.8em; }
        #question { font-size: 3.5em; margin: 20px 0 20px 0; }
        #startBtn, #homeBtn, #rankBtn { font-size: 1.1em; padding: 12px 30px; border-radius: 25px; }
        #rankList { width: 90%; padding: 15px; }
        #rankList h2 { font-size: 1.3em; }
    }
  </style>
</head>
<body>
  <h1>ã‚µãƒ¡ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h1>
  <div id="coinInfo">ğŸª™ ã‚µãƒ¡ã‚³ã‚¤ãƒ³: 0</div>
  <div id="info">ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­</div>
  <div id="questionNumber"></div>
  <div id="timer"></div>
  <div id="question">ğŸ¦ˆ</div>
  <div id="titleBadge"></div>
  <div id="rankList">
    <h2>ğŸ… ç§°å·ã¨å ±é…¬ä¸€è¦§</h2>
    <ul style="list-style: none; padding: 0;">
      <li>ğŸš€ ç¥é€Ÿã‚µãƒ¡ï¼š200ã‚³ã‚¤ãƒ³ï¼ˆï½45.0ç§’ï¼‰</li>
      <li>âš¡ é›»å…‰ã‚µãƒ¡ï¼š150ã‚³ã‚¤ãƒ³ï¼ˆï½50.0ç§’ï¼‰</li>
      <li>ğŸ’¨ ã¯ã‚„ã‚¶ãƒ¡ï¼š120ã‚³ã‚¤ãƒ³ï¼ˆï½55.0ç§’ï¼‰</li>
      <li>ğŸ„ ã‚¹ã‚¤ã‚¹ã‚¤ã‚µãƒ¡ï¼š90ã‚³ã‚¤ãƒ³ï¼ˆï½60.0ç§’ï¼‰</li>
      <li>ğŸ˜ ãŒã‚“ã°ã‚Šã‚¶ãƒ¡ï¼š70ã‚³ã‚¤ãƒ³ï¼ˆï½65.0ç§’ï¼‰</li>
      <li>ğŸ™‚ ãµã¤ã†ã‚¶ãƒ¡ï¼š50ã‚³ã‚¤ãƒ³ï¼ˆï½70.0ç§’ï¼‰</li>
      <li>ğŸ¢ ã®ã‚“ã³ã‚Šã‚µãƒ¡ï¼š30ã‚³ã‚¤ãƒ³ï¼ˆï½75.0ç§’ï¼‰</li>
      <li>ğŸ˜´ ã†ã¨ã†ã¨ã‚µãƒ¡ï¼š15ã‚³ã‚¤ãƒ³ï¼ˆï½80.0ç§’ï¼‰</li>
      <li>ğŸŒ ã¾ã£ãŸã‚Šã‚µãƒ¡ï¼š5ã‚³ã‚¤ãƒ³ï¼ˆ80.1ç§’ï½ï¼‰</li>
    </ul>
  </div>
  <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  <button id="homeBtn" style="display: none;">ãƒ›ãƒ¼ãƒ ã«ã‚‚ã©ã‚‹</button>
  <button id="rankBtn" style="display: inline-block;">ç§°å·ä¸€è¦§</button>

<script>
    const totalQuestions = 20; // å•é¡Œæ•°
    let problems = [];
    let selected = [];
    let index = 0;
    let showingAnswer = false;
    let startTime = null;
    let gameStarted = false;
    let timerInterval;

    // DOMè¦ç´ å–å¾—
    const question = document.getElementById("question");
    const questionNumber = document.getElementById("questionNumber");
    const timer = document.getElementById("timer");
    const info = document.getElementById("info");
    const titleBadge = document.getElementById("titleBadge");
    const startBtn = document.getElementById("startBtn");
    const homeBtn = document.getElementById("homeBtn");
    const coinInfo = document.getElementById("coinInfo");
    const rankBtn = document.getElementById("rankBtn");
    const rankList = document.getElementById("rankList");

    // --- ä¿®æ­£ç‚¹2: ç§°å·ã¨ã‚³ã‚¤ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ±åˆ ---
    const ranks = [
      { maxTime: 45.0, title: "ğŸš€ ç¥é€Ÿã‚µãƒ¡", coins: 200 },
      { maxTime: 50.0, title: "âš¡ é›»å…‰ã‚µãƒ¡", coins: 150 },
      { maxTime: 55.0, title: "ğŸ’¨ ã¯ã‚„ã‚¶ãƒ¡", coins: 120 },
      { maxTime: 60.0, title: "ğŸ„ ã‚¹ã‚¤ã‚¹ã‚¤ã‚µãƒ¡", coins: 90 },
      { maxTime: 65.0, title: "ğŸ˜ ãŒã‚“ã°ã‚Šã‚¶ãƒ¡", coins: 70 },
      { maxTime: 70.0, title: "ğŸ™‚ ãµã¤ã†ã‚¶ãƒ¡", coins: 50 },
      { maxTime: 75.0, title: "ğŸ¢ ã®ã‚“ã³ã‚Šã‚µãƒ¡", coins: 30 },
      { maxTime: 80.0, title: "ğŸ˜´ ã†ã¨ã†ã¨ã‚µãƒ¡", coins: 15 },
      { maxTime: Infinity, title: "ğŸŒ ã¾ã£ãŸã‚Šã‚µãƒ¡", coins: 5 } // æœ€å¾Œã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼
    ];

    // æ™‚é–“ã«å¿œã˜ãŸãƒ©ãƒ³ã‚¯æƒ…å ±ï¼ˆç§°å·ã¨ã‚³ã‚¤ãƒ³ï¼‰ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    function getRank(time) {
      const numericTime = parseFloat(time); // æ¯”è¼ƒã®ãŸã‚ã«æ•°å€¤ã«å¤‰æ›
      for (const rank of ranks) {
        if (numericTime <= rank.maxTime) {
          return rank;
        }
      }
      // é€šå¸¸ã¯Infinityã§ã‚­ãƒ£ãƒƒãƒã•ã‚Œã‚‹ãŒã€å¿µã®ãŸã‚æœ€å¾Œã‚’è¿”ã™
      return ranks[ranks.length - 1];
    }
    // --- ä¿®æ­£ç‚¹2 ã“ã“ã¾ã§ ---

    rankBtn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      rankList.style.display = rankList.style.display === "none" ? "block" : "none";
      // ã‚µã‚¦ãƒ³ãƒ‰ã¯ä»Šå›ãªã—
    });

    function toggleRankButton(show) {
      rankBtn.style.display = show ? "inline-block" : "none";
    }

    // localStorageã®ã‚­ãƒ¼ã‚’'sharkCoins'ã«å¤‰æ›´
    function getCoins() {
      return parseInt(localStorage.getItem("sharkCoins") || "0");
    }

    function setCoins(value) {
      localStorage.setItem("sharkCoins", value);
      coinInfo.textContent = `ğŸª™ ã‚µãƒ¡ã‚³ã‚¤ãƒ³: ${value}`;
    }

    function generateProblems() {
      problems = [];
      // 1æ¡+1æ¡ã®è¶³ã—ç®—ã‚’ç”Ÿæˆ
      for (let a = 1; a < 10; a++) { // 1ã‹ã‚‰9
        for (let b = 1; b < 10; b++) { // 1ã‹ã‚‰9
          // ç°¡å˜ã™ãã‚‹å•é¡Œ(ä¾‹: 1+1)ã‚„ç¹°ã‚Šä¸ŠãŒã‚Šæœ‰ç„¡ãªã©ã‚’è€ƒæ…®ã—ã¦èª¿æ•´ã‚‚å¯èƒ½
          problems.push({ q: `${a} + ${b}`, a: a + b });
        }
      }
      // --- ä¿®æ­£ç‚¹3: Fisher-Yatesã‚·ãƒ£ãƒƒãƒ•ãƒ«ã«å¤‰æ›´ ---
      for (let i = problems.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [problems[i], problems[j]] = [problems[j], problems[i]]; // è¦ç´ ã‚’å…¥ã‚Œæ›¿ãˆ
      }
      // --- ä¿®æ­£ç‚¹3 ã“ã“ã¾ã§ ---
      selected = problems.slice(0, totalQuestions); // 20å•é¸æŠ
    }

    function updateTimer() {
      const now = Date.now();
      const elapsed = ((now - startTime) / 1000).toFixed(1);
      timer.textContent = `ã‚¿ã‚¤ãƒ : ${elapsed} ç§’`;
    }

    // å•é¡Œè¡¨ç¤ºé–¢æ•° (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨)
    function showQuestion() {
      if (index < selected.length) {
        questionNumber.textContent = `(${index + 1}/${totalQuestions})`;
        // --- ä¿®æ­£ç‚¹7: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ ---
        question.textContent = selected[index].q;
        question.classList.remove('animate-reveal');
        void question.offsetWidth;
        question.classList.add('animate-reveal');
        // --- ä¿®æ­£ç‚¹7 ã“ã“ã¾ã§ ---
        showingAnswer = false;
      } else {
        endGame();
      }
    }

    // å›ç­”è¡¨ç¤ºé–¢æ•° (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨)
    function showAnswer() {
      // --- ä¿®æ­£ç‚¹7: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ ---
      question.textContent = selected[index].a;
      question.classList.remove('animate-reveal');
      void question.offsetWidth;
      question.classList.add('animate-reveal');
      // --- ä¿®æ­£ç‚¹7 ã“ã“ã¾ã§ ---
      showingAnswer = true;
    }

    function nextStep() {
      if (!gameStarted) return;
      if (!showingAnswer) {
        showAnswer();
      } else {
        index++;
        showQuestion();
      }
    }

    // assignTitle ã¨ calculateCoins é–¢æ•°ã¯ä¸è¦ã«ãªã£ãŸãŸã‚å‰Šé™¤

    function endGame() {
      toggleRankButton(true);
      clearInterval(timerInterval);
      gameStarted = false;
      homeBtn.style.display = "inline-block";
      const endTime = Date.now();
      const elapsed = ((endTime - startTime) / 1000).toFixed(1);

      // --- ä¿®æ­£ç‚¹2: getRanké–¢æ•°ã‚’ä½¿ã† ---
      const resultRank = getRank(elapsed);
      info.innerHTML = `<span class="highlight">ãŠã‚ã‚Šï¼ã‚¿ã‚¤ãƒ ï¼š${elapsed} ç§’</span>`;
      titleBadge.textContent = resultRank.title;
      const earned = resultRank.coins;
      // --- ä¿®æ­£ç‚¹2 ã“ã“ã¾ã§ ---

      const current = getCoins();
      setCoins(current + earned);

      // --- ä¿®æ­£ç‚¹6: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«æˆ»ã™ ---
      document.documentElement.style.overflowY = "auto";
      document.body.style.overflowY = "auto";
      // --- ä¿®æ­£ç‚¹6 ã“ã“ã¾ã§ ---

      setTimeout(() => {
        alert(`ğŸ‰ ${earned} ã‚³ã‚¤ãƒ³ã‚’ç²å¾—ã—ãŸã‚ˆï¼`);
      }, 300);
      // ã‚µã‚¦ãƒ³ãƒ‰åœæ­¢ã¯ä»Šå›ãªã—
    }

    startBtn.addEventListener("click", () => {
      document.documentElement.style.overflowY = "hidden";
      document.body.style.overflowY = "hidden";
      questionNumber.textContent = "";
      timer.textContent = "";
      toggleRankButton(false);
      // --- ä¿®æ­£ç‚¹5: ç§°å·ãƒªã‚¹ãƒˆã‚’éš ã™ ---
      rankList.style.display = "none";
      // --- ä¿®æ­£ç‚¹5 ã“ã“ã¾ã§ ---
      generateProblems();
      index = 0;
      gameStarted = true;
      startTime = Date.now();
      startBtn.style.display = "none";
      homeBtn.style.display = "none";
      info.textContent = "ãŒã‚“ã°ã£ã¦ã­ï¼";
      titleBadge.textContent = "";
      question.textContent = ''; // å‰ã®å•é¡Œã‚’ã‚¯ãƒªã‚¢
      showQuestion();
      timerInterval = setInterval(updateTimer, 100);
      // ã‚µã‚¦ãƒ³ãƒ‰é–‹å§‹ã¯ä»Šå›ãªã—
    });

    homeBtn.addEventListener("click", () => {
      // ã‚µã‚¦ãƒ³ãƒ‰åœæ­¢/å†ç”Ÿã¯ä»Šå›ãªã—
      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æœ‰åŠ¹åŒ–ã¯reloadã•ã‚Œã‚‹ã®ã§å¿…é ˆã§ã¯ãªã„
      location.reload();
    });

    // --- ä¿®æ­£ç‚¹4: bodyã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã®æ”¹å–„ ---
    document.body.addEventListener("click", (e) => {
      let targetElement = e.target;
      let isButtonOrRankList = false;
      // ç„¡è¦–ã™ã‚‹è¦ç´ ã®IDãƒªã‚¹ãƒˆ
      const ignoreIds = ["startBtn", "rankBtn", "homeBtn"];

      while (targetElement != null) {
          // IDãŒä¸€è‡´ã™ã‚‹ã‹ã€ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ãŸè¦ç´ ãŒ#rankListã®ä¸­ã«ã‚ã‚‹ã‹
          if (ignoreIds.includes(targetElement.id) || targetElement.closest('#rankList')) {
              isButtonOrRankList = true;
              break;
          }
          targetElement = targetElement.parentElement;
      }

      // ãƒœã‚¿ãƒ³ãƒ»ãƒ©ãƒ³ã‚¯ä¸€è¦§ä»¥å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ã‹ã¤ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿é€²è¡Œ
      if (!isButtonOrRankList && gameStarted) {
        // ã‚µã‚¦ãƒ³ãƒ‰å†ç”Ÿã¯ä»Šå›ãªã—
        nextStep();
      }
    });
    // --- ä¿®æ­£ç‚¹4 ã“ã“ã¾ã§ ---

    // åˆæœŸã‚³ã‚¤ãƒ³è¡¨ç¤º
    setCoins(getCoins());

    window.addEventListener('resize', () => { /* ãƒªã‚µã‚¤ã‚ºå‡¦ç†ã¯çœç•¥ */ });
  </script>
</body>
</html>
